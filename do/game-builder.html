<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>package builder ‚Äì winded.vertigo</title>
  <meta name="description" content="Build your custom learning experience package with our interactive builder.">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    /* =============================================
       WINDED.VERTIGO BRAND PALETTE - NEAR FUTURE 2050
       ============================================= */

    :root {
      /* Primary brand colors */
      --cadet-blue: #273248;
      --redwood: #b15043;
      --burnt-sienna: #cb7858;
      --champagne: #ffebd2;
      --white: #ffffff;

      /* Complementary accents */
      --periwinkle: #5872cb;
      --seafoam: #58cbb2;
      --light-lavender: #d5d2ff;
      --light-cyan: #d2fdff;

      /* Derived colors */
      --bg-primary: #1a2030;
      --bg-secondary: #232b3d;
      --bg-surface: #2d3548;
      --text-primary: var(--champagne);
      --text-dim: rgba(255, 235, 210, 0.6);
      --glow-redwood: 0 0 20px rgba(177, 80, 67, 0.5);
      --glow-sienna: 0 0 20px rgba(203, 120, 88, 0.5);
      --glow-periwinkle: 0 0 20px rgba(88, 114, 203, 0.4);

      /* Typography */
      --font-display: 'Space Mono', monospace;
      --font-ui: 'Inter', sans-serif;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: var(--font-ui);
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    /* =============================================
       LAYOUT
       ============================================= */

    .game-container {
      display: grid;
      grid-template-columns: 1fr 300px;
      grid-template-rows: auto 1fr auto;
      height: 100vh;
      gap: 0;
    }

    /* =============================================
       HEADER
       ============================================= */

    .quest-header {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 28px;
      background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
      border-bottom: 1px solid var(--burnt-sienna);
    }

    .quest-title {
      font-family: var(--font-display);
      font-size: 14px;
      color: var(--champagne);
      letter-spacing: 1px;
      text-transform: lowercase;
    }

    .quest-progress {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .progress-step {
      width: 32px;
      height: 4px;
      background: var(--bg-surface);
      border-radius: 2px;
      transition: all 0.4s ease;
      position: relative;
    }

    .progress-step.completed {
      background: var(--burnt-sienna);
    }

    .progress-step.active {
      background: var(--redwood);
      box-shadow: var(--glow-redwood);
    }

    .progress-step::after {
      content: attr(data-label);
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 9px;
      color: var(--text-dim);
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .progress-step:hover::after {
      opacity: 1;
    }

    /* =============================================
       MAIN 3D SCENE AREA
       ============================================= */

    .scene-area {
      position: relative;
      background: var(--bg-primary);
      overflow: hidden;
    }

    #three-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Prompt overlay */
    .quest-prompt {
      position: absolute;
      top: 32px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(26, 32, 48, 0.95);
      border: 1px solid var(--burnt-sienna);
      border-radius: 8px;
      padding: 20px 36px;
      text-align: center;
      backdrop-filter: blur(10px);
    }

    .quest-prompt h2 {
      font-family: var(--font-display);
      font-size: 16px;
      color: var(--champagne);
      margin-bottom: 8px;
      text-transform: lowercase;
      letter-spacing: 0.5px;
    }

    .quest-prompt p {
      font-size: 13px;
      color: var(--text-dim);
      max-width: 380px;
    }

    .quest-prompt .hint {
      margin-top: 12px;
      font-size: 11px;
      color: var(--burnt-sienna);
      font-style: italic;
    }

    /* =============================================
       SELECTABLE ITEMS (Click-to-select, not drag)
       ============================================= */

    .options-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 600px;
      padding: 20px;
    }

    .option-card {
      width: 140px;
      padding: 20px 16px;
      background: var(--bg-secondary);
      border: 2px solid var(--bg-surface);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .option-card:hover {
      border-color: var(--burnt-sienna);
      transform: translateY(-4px);
      box-shadow: var(--glow-sienna);
    }

    .option-card.selected {
      border-color: var(--redwood);
      background: rgba(177, 80, 67, 0.15);
      box-shadow: var(--glow-redwood);
    }

    .option-card .option-icon {
      width: 56px;
      height: 56px;
      background: var(--bg-surface);
      border: 2px solid var(--burnt-sienna);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
    }

    .option-card.selected .option-icon {
      background: var(--redwood);
      border-color: var(--redwood);
    }

    .option-card .option-label {
      font-family: var(--font-display);
      font-size: 11px;
      color: var(--champagne);
      text-transform: lowercase;
      margin-bottom: 4px;
    }

    .option-card .option-desc {
      font-size: 10px;
      color: var(--text-dim);
      line-height: 1.4;
    }

    /* Multi-select indicator */
    .option-card.multi-select::before {
      content: '';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 16px;
      height: 16px;
      border: 2px solid var(--bg-surface);
      border-radius: 4px;
      transition: all 0.3s ease;
    }

    .option-card.multi-select.selected::before {
      background: var(--redwood);
      border-color: var(--redwood);
    }

    .option-card.multi-select.selected::after {
      content: '‚úì';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 16px;
      height: 16px;
      color: var(--white);
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* =============================================
       INVENTORY SIDEBAR
       ============================================= */

    .inventory-panel {
      background: var(--bg-secondary);
      border-left: 1px solid var(--burnt-sienna);
      padding: 24px;
      display: flex;
      flex-direction: column;
    }

    .inventory-title {
      font-family: var(--font-display);
      font-size: 12px;
      color: var(--burnt-sienna);
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--bg-surface);
      letter-spacing: 1px;
      text-transform: lowercase;
    }

    .inventory-section {
      margin-bottom: 20px;
    }

    .inventory-section-title {
      font-size: 10px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .inventory-slot {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      background: var(--bg-surface);
      border-radius: 8px;
      margin-bottom: 8px;
      border: 1px solid transparent;
      transition: all 0.3s ease;
    }

    .inventory-slot.filled {
      border-color: var(--burnt-sienna);
      background: rgba(203, 120, 88, 0.1);
    }

    .inventory-slot .slot-icon {
      width: 32px;
      height: 32px;
      background: var(--bg-primary);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .inventory-slot.filled .slot-icon {
      background: var(--redwood);
    }

    .inventory-slot .slot-info {
      flex: 1;
    }

    .inventory-slot .slot-label {
      font-size: 11px;
      color: var(--text-dim);
      text-transform: lowercase;
    }

    .inventory-slot.filled .slot-label {
      color: var(--champagne);
      font-weight: 500;
    }

    .inventory-slot .slot-value {
      font-size: 9px;
      color: var(--burnt-sienna);
    }

    /* Multi-item slots */
    .inventory-multi {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .inventory-tag {
      padding: 4px 10px;
      background: var(--bg-surface);
      border-radius: 12px;
      font-size: 10px;
      color: var(--text-dim);
      border: 1px solid transparent;
    }

    .inventory-tag.filled {
      background: rgba(203, 120, 88, 0.2);
      border-color: var(--burnt-sienna);
      color: var(--champagne);
    }

    /* Quadrant indicator */
    .quadrant-indicator {
      margin-top: auto;
      padding: 16px;
      background: var(--bg-surface);
      border-radius: 8px;
      text-align: center;
    }

    .quadrant-label {
      font-size: 9px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .quadrant-value {
      font-family: var(--font-display);
      font-size: 14px;
      color: var(--redwood);
      text-transform: lowercase;
    }

    /* =============================================
       FOOTER - Navigation
       ============================================= */

    .quest-footer {
      grid-column: 1 / -1;
      display: flex;
      justify-content: center;
      gap: 16px;
      padding: 16px 28px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--bg-surface);
    }

    .nav-button {
      font-family: var(--font-ui);
      font-size: 13px;
      font-weight: 500;
      padding: 12px 28px;
      border: 1px solid var(--bg-surface);
      border-radius: 6px;
      background: transparent;
      color: var(--text-dim);
      cursor: pointer;
      text-transform: lowercase;
      transition: all 0.3s ease;
    }

    .nav-button:hover:not(:disabled) {
      border-color: var(--burnt-sienna);
      color: var(--champagne);
    }

    .nav-button.primary {
      background: var(--redwood);
      border-color: var(--redwood);
      color: var(--white);
    }

    .nav-button.primary:hover:not(:disabled) {
      background: var(--burnt-sienna);
      border-color: var(--burnt-sienna);
      box-shadow: var(--glow-sienna);
    }

    .nav-button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* =============================================
       GRID OVERLAY (Near-future aesthetic)
       ============================================= */

    .grid-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      background:
        linear-gradient(rgba(203, 120, 88, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(203, 120, 88, 0.02) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* =============================================
       RESPONSIVE
       ============================================= */

    @media (max-width: 768px) {
      .game-container {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr auto auto;
      }

      .inventory-panel {
        border-left: none;
        border-top: 1px solid var(--burnt-sienna);
        max-height: 200px;
        overflow-y: auto;
      }

      .options-container {
        gap: 12px;
      }

      .option-card {
        width: 120px;
        padding: 16px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="grid-overlay"></div>

  <div class="game-container">
    <!-- Header -->
    <header class="quest-header">
      <h1 class="quest-title">package builder</h1>
      <div class="quest-progress">
        <div class="progress-step active" data-step="1" data-label="focus"></div>
        <div class="progress-step" data-step="2" data-label="approach"></div>
        <div class="progress-step" data-step="3" data-label="services"></div>
        <div class="progress-step" data-step="4" data-label="goals"></div>
        <div class="progress-step" data-step="5" data-label="package"></div>
      </div>
    </header>

    <!-- Main Scene -->
    <div class="scene-area">
      <canvas id="three-canvas"></canvas>

      <!-- Prompt Overlay -->
      <div class="quest-prompt">
        <h2 id="prompt-title">what are you trying to change?</h2>
        <p id="prompt-subtitle">select one to continue</p>
        <p class="hint" id="prompt-hint"></p>
      </div>

      <!-- Selectable Options -->
      <div class="options-container" id="options-container"></div>
    </div>

    <!-- Inventory Panel -->
    <aside class="inventory-panel">
      <h2 class="inventory-title">your package</h2>

      <div class="inventory-section">
        <div class="inventory-section-title">foundation</div>
        <div class="inventory-slot" id="slot-focus">
          <div class="slot-icon">?</div>
          <div class="slot-info">
            <div class="slot-label">focus</div>
            <div class="slot-value" id="focus-value">‚Äî</div>
          </div>
        </div>
        <div class="inventory-slot" id="slot-approach">
          <div class="slot-icon">?</div>
          <div class="slot-info">
            <div class="slot-label">approach</div>
            <div class="slot-value" id="approach-value">‚Äî</div>
          </div>
        </div>
      </div>

      <div class="inventory-section">
        <div class="inventory-section-title">services</div>
        <div class="inventory-multi" id="services-container">
          <span class="inventory-tag">select services...</span>
        </div>
      </div>

      <div class="inventory-section">
        <div class="inventory-section-title">goals</div>
        <div class="inventory-multi" id="goals-container">
          <span class="inventory-tag">select goals...</span>
        </div>
      </div>

      <div class="quadrant-indicator">
        <div class="quadrant-label">quadrant</div>
        <div class="quadrant-value" id="quadrant-value">‚Äî</div>
      </div>
    </aside>

    <!-- Footer Navigation -->
    <footer class="quest-footer">
      <button class="nav-button" id="btn-back" disabled>‚Üê back</button>
      <button class="nav-button" id="btn-reset">‚Üª start over</button>
      <button class="nav-button primary" id="btn-next" disabled>continue ‚Üí</button>
    </footer>
  </div>

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <script>
    // =============================================
    // GAME STATE
    // =============================================
    const gameState = {
      step: 1,
      focus: null,      // people or product
      approach: null,   // design or research
      services: [],     // multi-select
      goals: []         // multi-select
    };

    // =============================================
    // STEP CONFIGURATION
    // =============================================
    const STEPS = {
      1: {
        title: "what are you trying to change?",
        subtitle: "select one to continue",
        hint: "",
        multiSelect: false,
        options: [
          {
            value: "people",
            icon: "üë•",
            label: "people",
            desc: "training, behaviour change, system adoption"
          },
          {
            value: "product",
            icon: "üéØ",
            label: "product",
            desc: "the tool, game, or experience itself"
          }
        ]
      },
      2: {
        title: "how do you want to approach it?",
        subtitle: "select one to continue",
        hint: "",
        multiSelect: false,
        options: [
          {
            value: "design",
            icon: "‚úèÔ∏è",
            label: "design",
            desc: "build, improve, make it work better"
          },
          {
            value: "research",
            icon: "üîç",
            label: "research",
            desc: "measure, prove, understand impact"
          }
        ]
      },
      3: {
        title: "which services match your needs?",
        subtitle: "select one or more, then continue",
        hint: "choose up to 4 services",
        multiSelect: true,
        maxSelect: 4,
        // Options populated dynamically based on quadrant
        options: []
      },
      4: {
        title: "what does success look like?",
        subtitle: "select one or more, then continue",
        hint: "choose up to 3 goals",
        multiSelect: true,
        maxSelect: 3,
        options: [
          { value: "prove", icon: "üìä", label: "prove it", desc: "demonstrate measurable impact" },
          { value: "improve", icon: "‚¨ÜÔ∏è", label: "improve it", desc: "make what exists better" },
          { value: "scale", icon: "üìà", label: "scale it", desc: "expand reach and adoption" },
          { value: "accessibility", icon: "‚ôø", label: "accessibility", desc: "ensure inclusive design" },
          { value: "concept", icon: "üí°", label: "concept sprint", desc: "rapid idea exploration" },
          { value: "prototype", icon: "üîß", label: "prototype", desc: "build a testable version" }
        ]
      },
      5: {
        title: "your package is ready",
        subtitle: "review your selections below",
        hint: ""
      }
    };

    // Services by quadrant (matching main site)
    const SERVICES_BY_QUADRANT = {
      'people-design': [
        { value: "trainings", icon: "üéì", label: "trainings", desc: "workshops and facilitation" },
        { value: "learning-experiences", icon: "üåü", label: "learning experiences", desc: "immersive programmes" },
        { value: "programmes", icon: "üìã", label: "programmes", desc: "structured learning journeys" },
        { value: "comms-assets", icon: "üì¢", label: "comms assets", desc: "materials that communicate" }
      ],
      'people-research': [
        { value: "programme-evaluation", icon: "üìä", label: "programme evaluation", desc: "measure programme impact" },
        { value: "mel-touchpoints", icon: "üìç", label: "MEL touchpoints", desc: "monitoring checkpoints" },
        { value: "psychometrics", icon: "üß†", label: "psychometrics", desc: "validated assessments" },
        { value: "evidence-for-funders", icon: "üíº", label: "evidence for funders", desc: "proof for stakeholders" }
      ],
      'product-design': [
        { value: "learning-tools", icon: "üõ†Ô∏è", label: "learning tools", desc: "educational products" },
        { value: "toys-games", icon: "üé≤", label: "toys/games", desc: "play-based products" },
        { value: "comms-assets", icon: "üé®", label: "comms assets", desc: "brand materials" },
        { value: "udl-improvements", icon: "‚ôø", label: "UDL improvements", desc: "accessibility upgrades" }
      ],
      'product-research': [
        { value: "exhibit-efficacy", icon: "üèõÔ∏è", label: "exhibit efficacy", desc: "does the exhibit work?" },
        { value: "toy-impacts", icon: "üéÆ", label: "toy impacts", desc: "play value research" },
        { value: "udl-validation", icon: "‚úÖ", label: "UDL validation", desc: "accessibility testing" },
        { value: "usability-testing", icon: "üë§", label: "usability testing", desc: "user experience research" }
      ]
    };

    const QUADRANT_NAMES = {
      'people-design': 'design & deploy',
      'people-research': 'pinpoint & prove',
      'product-design': 'build & iterate',
      'product-research': 'test & validate'
    };

    // =============================================
    // THREE.JS SCENE - NEAR FUTURE LAB
    // =============================================
    let scene, camera, renderer, labGroup;

    function initThreeJS() {
      const canvas = document.getElementById('three-canvas');
      const container = canvas.parentElement;

      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x1a2030);

      camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.set(0, 2, 8);
      camera.lookAt(0, 0, 0);

      renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

      // Soft ambient lighting
      const ambientLight = new THREE.AmbientLight(0xffebd2, 0.3);
      scene.add(ambientLight);

      // Warm accent lights (brand colors)
      const warmLight = new THREE.PointLight(0xcb7858, 0.8, 15);
      warmLight.position.set(-4, 3, 2);
      scene.add(warmLight);

      const coolLight = new THREE.PointLight(0x5872cb, 0.5, 15);
      coolLight.position.set(4, 3, 2);
      scene.add(coolLight);

      createLabEnvironment();

      window.addEventListener('resize', onWindowResize);
      animate();
    }

    function createLabEnvironment() {
      labGroup = new THREE.Group();

      // Floor grid - subtle, technical
      const gridHelper = new THREE.GridHelper(20, 40, 0x2d3548, 0x232b3d);
      gridHelper.position.y = -1.5;
      labGroup.add(gridHelper);

      // Floating platform
      const platformGeo = new THREE.CylinderGeometry(3, 3.2, 0.2, 32);
      const platformMat = new THREE.MeshBasicMaterial({
        color: 0x2d3548,
        transparent: true,
        opacity: 0.8
      });
      const platform = new THREE.Mesh(platformGeo, platformMat);
      platform.position.y = -1.4;
      labGroup.add(platform);

      // Platform ring
      const ringGeo = new THREE.RingGeometry(2.9, 3.1, 64);
      const ringMat = new THREE.MeshBasicMaterial({
        color: 0xcb7858,
        side: THREE.DoubleSide,
        transparent: true,
        opacity: 0.6
      });
      const ring = new THREE.Mesh(ringGeo, ringMat);
      ring.rotation.x = -Math.PI / 2;
      ring.position.y = -1.29;
      labGroup.add(ring);

      // Vertical accent lines
      for (let i = 0; i < 6; i++) {
        const angle = (i / 6) * Math.PI * 2;
        const lineGeo = new THREE.BufferGeometry().setFromPoints([
          new THREE.Vector3(Math.cos(angle) * 4, -1.5, Math.sin(angle) * 4),
          new THREE.Vector3(Math.cos(angle) * 4, 3, Math.sin(angle) * 4)
        ]);
        const lineMat = new THREE.LineBasicMaterial({
          color: 0x5872cb,
          transparent: true,
          opacity: 0.3
        });
        const line = new THREE.Line(lineGeo, lineMat);
        labGroup.add(line);
      }

      // Central holographic element
      const holoGeo = new THREE.IcosahedronGeometry(0.8, 1);
      const holoMat = new THREE.MeshBasicMaterial({
        color: 0xb15043,
        wireframe: true,
        transparent: true,
        opacity: 0.6
      });
      const holo = new THREE.Mesh(holoGeo, holoMat);
      holo.position.y = 0.5;
      holo.name = 'holo';
      labGroup.add(holo);

      // Outer ring
      const outerRingGeo = new THREE.TorusGeometry(1.2, 0.02, 8, 64);
      const outerRingMat = new THREE.MeshBasicMaterial({
        color: 0xcb7858,
        transparent: true,
        opacity: 0.5
      });
      const outerRing = new THREE.Mesh(outerRingGeo, outerRingMat);
      outerRing.position.y = 0.5;
      outerRing.rotation.x = Math.PI / 2;
      outerRing.name = 'outerRing';
      labGroup.add(outerRing);

      scene.add(labGroup);
    }

    function onWindowResize() {
      const container = document.getElementById('three-canvas').parentElement;
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    }

    function animate() {
      requestAnimationFrame(animate);

      const holo = labGroup.getObjectByName('holo');
      const outerRing = labGroup.getObjectByName('outerRing');

      if (holo) {
        holo.rotation.y += 0.005;
        holo.rotation.x += 0.002;
      }

      if (outerRing) {
        outerRing.rotation.z += 0.003;
      }

      // Subtle camera movement
      camera.position.x = Math.sin(Date.now() * 0.0003) * 0.5;
      camera.lookAt(0, 0.3, 0);

      renderer.render(scene, camera);
    }

    // =============================================
    // UI RENDERING
    // =============================================
    function renderStep() {
      const step = STEPS[gameState.step];

      // Update progress bar
      document.querySelectorAll('.progress-step').forEach((el, i) => {
        el.classList.remove('active', 'completed');
        if (i + 1 < gameState.step) el.classList.add('completed');
        if (i + 1 === gameState.step) el.classList.add('active');
      });

      // Update prompt
      document.getElementById('prompt-title').textContent = step.title;
      document.getElementById('prompt-subtitle').textContent = step.subtitle;
      document.getElementById('prompt-hint').textContent = step.hint || '';

      // Update navigation
      document.getElementById('btn-back').disabled = gameState.step === 1;
      document.getElementById('btn-next').disabled = !canProceed();

      // Render options
      renderOptions();

      // Update inventory display
      updateInventoryDisplay();
    }

    function renderOptions() {
      const container = document.getElementById('options-container');
      container.innerHTML = '';

      if (gameState.step === 5) {
        // Final step - show summary
        renderSummary();
        return;
      }

      let options = STEPS[gameState.step].options;

      // For step 3, get options based on quadrant
      if (gameState.step === 3) {
        const quadrant = getQuadrant();
        options = SERVICES_BY_QUADRANT[quadrant] || [];
      }

      const multiSelect = STEPS[gameState.step].multiSelect;

      options.forEach(opt => {
        const card = document.createElement('div');
        card.className = 'option-card' + (multiSelect ? ' multi-select' : '');
        card.dataset.value = opt.value;

        // Check if selected
        if (isSelected(opt.value)) {
          card.classList.add('selected');
        }

        card.innerHTML = `
          <div class="option-icon">${opt.icon}</div>
          <div class="option-label">${opt.label}</div>
          <div class="option-desc">${opt.desc}</div>
        `;

        card.addEventListener('click', () => handleSelection(opt.value, multiSelect));
        container.appendChild(card);
      });
    }

    function renderSummary() {
      const container = document.getElementById('options-container');
      container.innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <div style="font-size: 48px; margin-bottom: 16px;">‚ú®</div>
          <p style="color: var(--champagne); font-size: 14px; margin-bottom: 24px;">
            your ${QUADRANT_NAMES[getQuadrant()]} package is configured
          </p>
          <a href="https://calendar.app.google/ZXVqJLdprmUZk1DW6"
             target="_blank"
             rel="noopener noreferrer"
             style="display: inline-block; padding: 14px 28px; background: var(--redwood); color: white; text-decoration: none; border-radius: 6px; font-weight: 500; text-transform: lowercase;">
            book a playdate ‚Üí
          </a>
        </div>
      `;
    }

    function isSelected(value) {
      if (gameState.step === 1) return gameState.focus === value;
      if (gameState.step === 2) return gameState.approach === value;
      if (gameState.step === 3) return gameState.services.includes(value);
      if (gameState.step === 4) return gameState.goals.includes(value);
      return false;
    }

    function handleSelection(value, multiSelect) {
      if (gameState.step === 1) {
        gameState.focus = value;
        // Auto-advance for single-select
        setTimeout(() => { gameState.step = 2; renderStep(); }, 300);
      }
      else if (gameState.step === 2) {
        gameState.approach = value;
        // Auto-advance for single-select
        setTimeout(() => { gameState.step = 3; renderStep(); }, 300);
      }
      else if (gameState.step === 3) {
        toggleArrayValue(gameState.services, value, STEPS[3].maxSelect);
        renderStep();
      }
      else if (gameState.step === 4) {
        toggleArrayValue(gameState.goals, value, STEPS[4].maxSelect);
        renderStep();
      }
    }

    function toggleArrayValue(arr, value, max) {
      const idx = arr.indexOf(value);
      if (idx > -1) {
        arr.splice(idx, 1);
      } else if (arr.length < max) {
        arr.push(value);
      }
    }

    function canProceed() {
      if (gameState.step === 1) return gameState.focus !== null;
      if (gameState.step === 2) return gameState.approach !== null;
      if (gameState.step === 3) return gameState.services.length > 0;
      if (gameState.step === 4) return gameState.goals.length > 0;
      return true;
    }

    function getQuadrant() {
      if (gameState.focus && gameState.approach) {
        return `${gameState.focus}-${gameState.approach}`;
      }
      return null;
    }

    function updateInventoryDisplay() {
      // Focus slot
      const focusSlot = document.getElementById('slot-focus');
      const focusValue = document.getElementById('focus-value');
      if (gameState.focus) {
        focusSlot.classList.add('filled');
        focusSlot.querySelector('.slot-icon').textContent = gameState.focus === 'people' ? 'üë•' : 'üéØ';
        focusValue.textContent = gameState.focus;
      } else {
        focusSlot.classList.remove('filled');
        focusSlot.querySelector('.slot-icon').textContent = '?';
        focusValue.textContent = '‚Äî';
      }

      // Approach slot
      const approachSlot = document.getElementById('slot-approach');
      const approachValue = document.getElementById('approach-value');
      if (gameState.approach) {
        approachSlot.classList.add('filled');
        approachSlot.querySelector('.slot-icon').textContent = gameState.approach === 'design' ? '‚úèÔ∏è' : 'üîç';
        approachValue.textContent = gameState.approach;
      } else {
        approachSlot.classList.remove('filled');
        approachSlot.querySelector('.slot-icon').textContent = '?';
        approachValue.textContent = '‚Äî';
      }

      // Services
      const servicesContainer = document.getElementById('services-container');
      if (gameState.services.length > 0) {
        servicesContainer.innerHTML = gameState.services.map(s =>
          `<span class="inventory-tag filled">${s.replace(/-/g, ' ')}</span>`
        ).join('');
      } else {
        servicesContainer.innerHTML = '<span class="inventory-tag">select services...</span>';
      }

      // Goals
      const goalsContainer = document.getElementById('goals-container');
      if (gameState.goals.length > 0) {
        goalsContainer.innerHTML = gameState.goals.map(g =>
          `<span class="inventory-tag filled">${g}</span>`
        ).join('');
      } else {
        goalsContainer.innerHTML = '<span class="inventory-tag">select goals...</span>';
      }

      // Quadrant
      const quadrant = getQuadrant();
      document.getElementById('quadrant-value').textContent = quadrant ? QUADRANT_NAMES[quadrant] : '‚Äî';
    }

    // =============================================
    // NAVIGATION
    // =============================================
    function initNavigation() {
      document.getElementById('btn-next').addEventListener('click', () => {
        if (gameState.step < 5) {
          gameState.step++;
          renderStep();
        }
      });

      document.getElementById('btn-back').addEventListener('click', () => {
        if (gameState.step > 1) {
          gameState.step--;
          renderStep();
        }
      });

      document.getElementById('btn-reset').addEventListener('click', () => {
        gameState.step = 1;
        gameState.focus = null;
        gameState.approach = null;
        gameState.services = [];
        gameState.goals = [];
        renderStep();
      });
    }

    // =============================================
    // INIT
    // =============================================
    document.addEventListener('DOMContentLoaded', () => {
      initThreeJS();
      initNavigation();
      renderStep();
    });
  </script>
</body>
</html>
